{% extends "base.html" %}
{% block content %}
  <div class="d-flex flex-wrap gap-2 justify-content-between align-items-end mb-3">
    <div>
      <h3 class="mb-1">People</h3>
      <div class="text-secondary">People allowed in the condo and their linked photos.</div>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary" href="{{ url_for('snapshots') }}"><i class="bi bi-image me-1"></i>Photos</a>
      <a class="btn btn-outline-primary" href="{{ url_for('training') }}"><i class="bi bi-camera-video me-1"></i>Training</a>
    </div>
  </div>

  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <div class="fw-semibold mb-2">Add a person</div>
      <form method="post" action="{{ url_for('faces_new') }}" class="row g-2 align-items-end">
        <div class="col-12 col-md-5">
          <label class="form-label small text-secondary mb-1">Name</label>
          <input name="name" class="form-control" placeholder="e.g., Tepan" required>
        </div>
        <div class="col-12 col-md-5">
          <label class="form-label small text-secondary mb-1">Note (optional)</label>
          <input name="note" class="form-control" placeholder="owner, roommate, staff">
        </div>
        <div class="col-12 col-md-2">
          <button class="btn btn-primary w-100" type="submit"><i class="bi bi-plus-lg me-1"></i>Create</button>
        </div>
      </form>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <div class="fw-semibold mb-2">People list</div>
      {% if faces|length == 0 %}
        <div class="text-secondary">No people yet. Add from a photo or create a new person above.</div>
      {% else %}
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead>
              <tr>
                <th style="width: 90px;">ID</th>
                <th>Name</th>
                <th style="width: 120px;">Photos</th>
                <th style="width: 240px;">Created</th>
                <th>Note</th>
                <th style="width: 160px;">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for f in faces %}
              <tr>
                <td class="font-monospace">#{{ f["id"] }}</td>
                <td class="fw-semibold">{{ f["name"] }}</td>
                <td><span class="badge text-bg-secondary">{{ f["sample_count"] }}</span></td>
                <td class="font-monospace small">{{ f["created_ts"] }}</td>
                <td class="text-break">{{ f["note"] or "" }}</td>
                <td class="d-flex gap-2">
                  <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('face_details', face_id=f['id']) }}"><i class="bi bi-eye"></i></a>
                  <form method="post" action="{{ url_for('faces_delete', face_id=f['id']) }}" onsubmit="return confirm('Delete this person?');">
                    <button class="btn btn-sm btn-outline-danger" type="submit"><i class="bi bi-trash"></i></button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% endif %}
      <div class="text-secondary small mt-3">
        <form method="post" action="{{ url_for('faces_retrain') }}" class="d-inline">
          <button class="btn btn-outline-primary" type="submit">
            <i class="bi bi-cpu me-1"></i>Update Face Recognition
          </button>
        </form>
      </div>
    </div>
  </div>
{% endblock %}
