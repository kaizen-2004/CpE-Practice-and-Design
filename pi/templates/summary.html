{% extends "base.html" %}
{% block content %}
  <div class="d-flex flex-wrap gap-2 justify-content-between align-items-end mb-3">
    <div>
      <h3 class="mb-1">Daily Summary</h3>
      <div class="text-secondary">Counts used for Chapter 4 (works now with simulated data).</div>
    </div>
    <div class="d-flex gap-2 flex-wrap">
      <a class="btn btn-outline-secondary" href="{{ url_for('summary', date=date_str) }}"><i class="bi bi-arrow-clockwise me-1"></i>Refresh</a>
      <a class="btn btn-outline-secondary" href="{{ url_for('summary_csv', date=date_str) }}"><i class="bi bi-download me-1"></i>CSV</a>
      <a class="btn btn-outline-secondary" href="{{ url_for('summary_html_export', date=date_str) }}"><i class="bi bi-download me-1"></i>HTML</a>
    </div>
  </div>

  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <form method="get" class="row g-2 align-items-end">
        <div class="col-12 col-md-4">
          <label class="form-label small text-secondary mb-1">Date (UTC)</label>
          <select name="date" class="form-select">
            {% for d in date_options %}
              <option value="{{ d }}" {{ "selected" if d==date_str else "" }}>{{ d }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-12 col-md-2">
          <button class="btn btn-primary w-100" type="submit"><i class="bi bi-check2 me-1"></i>View</button>
        </div>
        <div class="col-12 col-md-6 text-secondary small">
          Window: <span class="font-monospace">{{ data["start"] }}</span> â†’ <span class="font-monospace">{{ data["end"] }}</span>
        </div>
      </form>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-12 col-lg-4">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <div class="fw-semibold mb-2">Alerts by status</div>
          {% if data["alerts_by_status"]|length == 0 %}
            <div class="text-secondary">No alerts for this date.</div>
          {% else %}
            <ul class="list-group list-group-flush">
              {% for r in data["alerts_by_status"] %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <span class="badge text-bg-secondary">{{ r["status"] }}</span>
                  <span class="fw-semibold">{{ r["c"] }}</span>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-8">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <div class="fw-semibold mb-2">Alerts by type/status</div>
          {% if data["alerts_by_type_status"]|length == 0 %}
            <div class="text-secondary">No alerts for this date.</div>
          {% else %}
            <div class="table-responsive">
              <table class="table table-sm table-hover align-middle mb-0">
                <thead>
                  <tr><th>Type</th><th>Status</th><th style="width:120px;">Count</th></tr>
                </thead>
                <tbody>
                  {% for r in data["alerts_by_type_status"] %}
                    <tr>
                      <td><span class="badge text-bg-dark-subtle border">{{ r["type"] }}</span></td>
                      <td><span class="badge text-bg-secondary">{{ r["status"] }}</span></td>
                      <td class="fw-semibold">{{ r["c"] }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="fw-semibold mb-2">Events by type</div>
          {% if data["events_by_type"]|length == 0 %}
            <div class="text-secondary">No events for this date.</div>
          {% else %}
            <div class="table-responsive">
              <table class="table table-sm table-hover align-middle mb-0">
                <thead><tr><th>Type</th><th style="width:120px;">Count</th></tr></thead>
                <tbody>
                  {% for r in data["events_by_type"] %}
                    <tr>
                      <td><span class="badge text-bg-dark-subtle border">{{ r["type"] }}</span></td>
                      <td class="fw-semibold">{{ r["c"] }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="fw-semibold mb-2">Snapshots by type/label</div>
          {% if data["snapshots_by_type_label"]|length == 0 %}
            <div class="text-secondary">No snapshots for this date.</div>
          {% else %}
            <div class="table-responsive">
              <table class="table table-sm table-hover align-middle mb-0">
                <thead><tr><th>Type</th><th>Label</th><th style="width:120px;">Count</th></tr></thead>
                <tbody>
                  {% for r in data["snapshots_by_type_label"] %}
                    <tr>
                      <td><span class="badge text-bg-dark-subtle border">{{ r["type"] }}</span></td>
                      <td>{{ r["label"] if r["label"] else "-" }}</td>
                      <td class="fw-semibold">{{ r["c"] }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="fw-semibold mb-2">Top rooms (alerts)</div>
          {% if data["top_rooms"]|length == 0 %}
            <div class="text-secondary">No room data for this date.</div>
          {% else %}
            <div class="d-flex flex-wrap gap-2">
              {% for r in data["top_rooms"] %}
                <span class="badge text-bg-primary-subtle border border-primary-subtle">{{ r["room"] }}: {{ r["c"] }}</span>
              {% endfor %}
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}
